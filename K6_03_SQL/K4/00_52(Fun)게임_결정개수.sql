use Game4FarmVill4
GO
/*
-- 세이브 데이타에서 결정수량을 파악
select dbo.fnu_GetFVSaveDataToCashcost('xxxxxx')
select dbo.fnu_GetFVSaveDataToCashcost('14:62127863165%270:213640%1:24280,24281,24283,24285,24286%2:30%3:2018,2018,2018,2018,2018,2018,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017%4:533,531,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1%5:11,11,7,11,7,11,11,9,5,10,9,11,10,9,11,10,10,11,11,11,11,11,10,5,8,8,10,8,11,4,11,11,7,10,11,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1%280:%6:5042%7:3%8:69%27:37213%19:4000,4001,4002,4003,4004,4005,4006,4007,4008,4009,4010,4011,4012,4013,4014,4015,4016,4017,4018,4019,4020,4021,4022,4023,4024,4025,4026,4027,4028,4029,4030,4031,4032,4033,4034,4035,4036,4037,4038,4039,4040%50:172512732,172512732,172512732,0,0,0,0,0,0,0,0,0%51:517538196%52:822187959726%40:4000@6,4001@6,4002@6,4003@6,4004@6,4005@6,4006@6,4007@6,4008@6,4009@6,4010@6,4011@6,4012@6,4013@6,4014@6,4015@6,4016@6,4017@6,4018@6,4019@6,4020@6,4021@6,4022@6,4023@6,4024@6,4025@6,4026@6,4027@6,4028@6,4029@6,4030@6,4031@6,4032@6,4033@6,4034@6,4035@6,4036@6,4037@6,4038@6,4039@6,4040@6%9:24848,13069,8350,6554,5182,4659,4250,3838,3809,2749,71332,63878,51357,65853,21710,454200,8907,20649,58977,69673,13623,0,0,0%100:24310%101:24326%102:24289%13:1287000%21:1%22:1%23:1%260:1%28:-1%29:-1%34:%35:%30:7002,7001,7004,7003,7000,7012,7014%15:3854%24:2086960458697%31:2,0,1,6,3,8,10,13,4,9,5,7,12,16,11,18,19,23,20,28,22,21,15,29,17,14,26,33,38,32,39,30,25,27,31,48,43,36,42,40,24,41,58,37,35,53,52,46,49,56,50,34,51,62,47,45,57,66,68,63,61,55,67,60,65,59%16:12%17:1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0%18:5016%25:30%36:24303%33:test_for_pc%37:com.sangsangdigital.farmgg@com.TouchTouch.SuddenRich_Kakao%60:0%61:60486%62:3005%63:223%65:105%70:30%85:1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0%86:11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,10,9,7,1,1,1,1,1%88:04/09/2015 03@54@31^04/09/2015 03@54@32^04/09/2015 03@54@34^04/09/2015 03@54@36^03/29/2015 12@09@59^04/09/2015 03@54@39^04/03/2015 12@30@06^04/09/2015 03@54@41^04/09/2015 03@54@43^04/09/2015 03@54@45^04/09/2015 03@54@47^04/09/2015 03@54@49^04/09/2015 03@54@51^04/09/2015 03@54@53^04/09/2015 03@54@56^04/07/2015 14@23@01^03/31/2015 05@26@37^03/27/2015 08@21@00^-1^-1^-1^-1^-1%93:0^0^0^11^33260@1^0^0^11^10700@3^0^0^11^40785@4^0^0^11^37018@5^0^0^11^32223@6^0^0^11^6707@7^0^0^11^29499@8^0^0^11^28461@9^0^0^11^25748@10^0^0^11^24691@11^0^0^11^18232@12^0^0^11^17635@13^0^0^11^17159@14^0^0^11^14463@15^0^0^10^13935@16^0^0^9^13541@17^0^0^7^3451%201:11%210:2084%221:11%250:30%290:4%300:02/16/2016 13@23@46%400:%410:-1,-1,-1%500:03/25/2015 19@30@57%600:0%501:1321')
*/
IF OBJECT_ID ( N'dbo.fnu_GetFVSaveDataToCashcost', N'FN' ) IS NOT NULL
	DROP FUNCTION dbo.fnu_GetFVSaveDataToCashcost;
GO

CREATE FUNCTION dbo.fnu_GetFVSaveDataToCashcost(
	@strValue_ 			varchar(8000)
)
	RETURNS bigint
AS
BEGIN
	--declare @strValue_ 	varchar(8000)
	--set @strValue_		= '14:62127863165%270:213640%1:24280,24281,24283,24285,24286%2:30%3:2018,2018,2018,2018,2018,2018,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017%4:533,531,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,530,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1%5:11,11,7,11,7,11,11,9,5,10,9,11,10,9,11,10,10,11,11,11,11,11,10,5,8,8,10,8,11,4,11,11,7,10,11,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1%280:%6:5042%7:3%8:69%27:37213%19:4000,4001,4002,4003,4004,4005,4006,4007,4008,4009,4010,4011,4012,4013,4014,4015,4016,4017,4018,4019,4020,4021,4022,4023,4024,4025,4026,4027,4028,4029,4030,4031,4032,4033,4034,4035,4036,4037,4038,4039,4040%50:172512732,172512732,172512732,0,0,0,0,0,0,0,0,0%51:517538196%52:822187959726%40:4000@6,4001@6,4002@6,4003@6,4004@6,4005@6,4006@6,4007@6,4008@6,4009@6,4010@6,4011@6,4012@6,4013@6,4014@6,4015@6,4016@6,4017@6,4018@6,4019@6,4020@6,4021@6,4022@6,4023@6,4024@6,4025@6,4026@6,4027@6,4028@6,4029@6,4030@6,4031@6,4032@6,4033@6,4034@6,4035@6,4036@6,4037@6,4038@6,4039@6,4040@6%9:24848,13069,8350,6554,5182,4659,4250,3838,3809,2749,71332,63878,51357,65853,21710,454200,8907,20649,58977,69673,13623,0,0,0%100:24310%101:24326%102:24289%13:1287000%21:1%22:1%23:1%260:1%28:-1%29:-1%34:%35:%30:7002,7001,7004,7003,7000,7012,7014%15:3854%24:2086960458697%31:2,0,1,6,3,8,10,13,4,9,5,7,12,16,11,18,19,23,20,28,22,21,15,29,17,14,26,33,38,32,39,30,25,27,31,48,43,36,42,40,24,41,58,37,35,53,52,46,49,56,50,34,51,62,47,45,57,66,68,63,61,55,67,60,65,59%16:12%17:1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0%18:5016%25:30%36:24303%33:test_for_pc%37:com.sangsangdigital.farmgg@com.TouchTouch.SuddenRich_Kakao%60:0%61:60486%62:3005%63:223%65:105%70:30%85:1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0%86:11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,10,9,7,1,1,1,1,1%88:04/09/2015 03@54@31^04/09/2015 03@54@32^04/09/2015 03@54@34^04/09/2015 03@54@36^03/29/2015 12@09@59^04/09/2015 03@54@39^04/03/2015 12@30@06^04/09/2015 03@54@41^04/09/2015 03@54@43^04/09/2015 03@54@45^04/09/2015 03@54@47^04/09/2015 03@54@49^04/09/2015 03@54@51^04/09/2015 03@54@53^04/09/2015 03@54@56^04/07/2015 14@23@01^03/31/2015 05@26@37^03/27/2015 08@21@00^-1^-1^-1^-1^-1%93:0^0^0^11^33260@1^0^0^11^10700@3^0^0^11^40785@4^0^0^11^37018@5^0^0^11^32223@6^0^0^11^6707@7^0^0^11^29499@8^0^0^11^28461@9^0^0^11^25748@10^0^0^11^24691@11^0^0^11^18232@12^0^0^11^17635@13^0^0^11^17159@14^0^0^11^14463@15^0^0^10^13935@16^0^0^9^13541@17^0^0^7^3451%201:11%210:2084%221:11%250:30%290:4%300:02/16/2016 13@23@46%400:%410:-1,-1,-1%500:03/25/2015 19@30@57%600:0%501:1321'
	--set @strValue_		= 'xxxx'
	--set @strValue_		= 'xxxx%9:1,2,3'

	declare @rtn 				bigint				set @rtn		= 0
	declare @charSplit_ 		varchar(3)			set @charSplit_ = '%9:'
	declare @charSplit2_ 		varchar(3)			set @charSplit2_= '%'
	declare @posStart 	int,
			@posNext 	int
	set @posStart 	= 1 	-- 구분문자 검색을 시작할 위치
	set @posNext 	= 1 	-- 구분문자 위치

	set @posStart 	= CHARINDEX(@charSplit_, @strValue_, @posStart)
	set @posNext 	= CHARINDEX(@charSplit2_, @strValue_, @posStart + 1)
	if(@posStart != 0 and @posNext != 0)
		begin
			set @strValue_ 	= SUBSTRING(@strValue_, @posStart + 3, @posNext - @posStart - 3)
		end
	else
		begin
			set @strValue_ = ''
		end
	--select 'DEBUG', @strValue_ strValue_, @posStart posStart, @posNext posNext
	--%9:24848,13069,8350,6554,5182,4659,4250,3838,3809,2749,71332,63878,51357,65853,21710,454200,8907,20649,58977,69673,13623,0,0,0
	--   24848,13069,8350,6554,5182,4659,4250,3838,3809,2749,71332,63878,51357,65853,21710,454200,8907,20649,58977,69673,13623,0,0,0

	if(LEN(@strValue_) >= 3)
		begin
			--SELECT * FROM dbo.fnu_SplitOne(',', '1') where idx = 15
			--SELECT * FROM dbo.fnu_SplitOne(',', '1,2,3,4,5,6,12,13,14') where idx = 15
			--SELECT * FROM dbo.fnu_SplitOne(',', '24848,13069,8350,6554,5182,4659,4250,3838,3809,2749,71332,63878,51357,65853,21710,454200,8907,20649,58977,69673,13623,0,0,0') where idx = 15
			SELECT @rtn = listidx FROM dbo.fnu_SplitOne(',', @strValue_) where idx = 15
		end
	--select 'DEBUG', @rtn rtn


	RETURN @rtn
END
